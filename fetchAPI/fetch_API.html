<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Fetch API</title>
    <style>
        p {
            padding: 0 20px;
        }
        
        img {
            min-height: 400px;
        }
        
        .posts {
            display: flex;
        }
        
        .posts {
            height: 100px;
        }
    </style>
</head>

<body>
    <h1>Fetch API</h1>
    <h5>Fetch is similar to xml or http requests but better. I allows us to get or post data from and to a server.</h5>
    <p>Fetch always succeeds therefore <strong> .cath(error => console.log(error)</strong> will not return any error. The only time you get an error is when you get an errorwith fetch itself and not the api you are calling. For example absence of internet.
    </p>
    <p>
        To curb this, ypou can check if response is ok in the first ,then
    </p>
    <p>Fetch ahs an options section - where you can get post delete data </p>
    <p>Fetch takes one mandatory argument, the path to the resource you want to fetch and returns a <strong>Promise</strong> the resolves <strong>resolves</strong> to the <strong>response</strong>to thet request. That is as soon as the server responds with
        headers - <strong>
        even if the server response is a HTTP error status.
    </strong> You can also optionally pass an init option object as the second argument,</p>
    <p>Once the <strong>response</strong> is retrieved there are a number of methods available to define what the body content is and and how it should be handled.</p>
    <p>**********************************************************</p>

    <p>**************************************************************</p>

    <h1>My Blog post</h1>
    <section id="posts"></section>

    <template id="post-template">
        <div class="post">
            <img src="" alt="post-image here" class="post_img">
            <h4 class="post_title"></h4>
            <p class="post_body"></p>
        </div>
    </template>

    <script>
        let users = fetch("https://reqres.in/api/users", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    name: "User 1"
                })
            })
            .then(res => {
                if (res.ok) {
                    console.log("Succesful")
                    return res.json()
                } else {
                    console.log("Not Succesful")
                }
            })
            .then(data => console.log(data.name))





        //load/fetch random image into a div
        fetch("https://unsplash.it/600/400")
            .then(response => response.blob())
            .then(blob => {
                let img = document.createElement("img")
                img.src = URL.createObjectURL(blob)
                document.querySelector(".post_img").appendChild(img)
            })




        console.log("%cFetch API Explained - codeSTACKr yt", "color: green") //synchronous- loaded immediately


        //my blog post 
        const postSection = document.querySelector("#posts")
        const postTemplate = document.querySelector("#post-template")

        getData()
        async function getData() {
            //fetch 100 posts from api - json placeholder
            const postStream = await fetch("https://jsonplaceholder.typicode.com/posts")
            const posts = await postStream.json()
                //console.log(posts)

            let i = 0

            //iterate trhough the first nine items of posts, which is n array, using forEach, a higher order/level array function
            posts.forEach(post => {
                i++
                if (i < 100) {
                    fetch("https://unsplash.it/600/400")
                        .then(response => response.blob())
                        .then(blob => {
                            const title = post.title
                            const body = post.body

                            const newPost = document.importNode(postTemplate.content, true)
                            const postTitle = newPost.querySelector(".post_title")
                            const postBody = newPost.querySelector(".post_body")
                            const postImage = newPost.querySelector("post_img")

                            postTitle.innerText = title
                            postBody.innerText = body


                            postImage.src = URL.createObjectURL(blob)

                        })


                    postSection.appendChild(newPost)
                }
            })
        }
    </script>
</body>

</html>